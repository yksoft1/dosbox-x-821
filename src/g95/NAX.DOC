
	----------------------------------------------------------------
		《ＮＡＸ》		Version 4.05 ドキュメント
	----------------------------------------------------------------


●概要

	　「ＮＡＸ」とは、みゅあっぷ98N怨柾繧ﾅ作成された演奏ファイル(*.O)
	を演奏するための、YM2608/2203/3438用SSGPCM搭載音源ドライバです。
	　YM2203のみでも、PCMが3チャネル使用可能です。


●バージョンの注意

	　みゅあっぷ98（N怨磨jのバージョンにより、使用するドライバも異な
	ります。
			(1) V4.XX → ＮＡＸ
			(2) V3.XX → ＮＡＸ
			(3) V2.XX → ＮＡ
			(4) V1.XX → ＮＬ

	基本的に、各バージョンでのオブジェクトの互換性はありません。ド
	ライバを変更する場合は適合するみゅあっぷ98で再アセンブルして下
	さい。


●CPUの制限

	　PC-9801M以前の機種では動作しません。CPUは必ずV30以上を使用し
	て下さい。また、CPUの実行速度に依存しないFM音源出力のウェイト時
	間を持っているため、あらゆる高速CPUでの動作が可能です。
	　SSGPCMを使用する場合は、必ず80286以上搭載機種での動作をお願い
	します。


●添付ファイル確認

	　「みゅあっぷ98N怨磨v添付のＮＡＸには以下のファイルが収録されて
	います。

		NAX.COM			本体
		NAX.DOC			解説文
		TONES.DTA		FM音源音色パラメータファイル
		MAKESSG.COM		SSGPCMデータファイル生成ツール
		MAKESSG.DOC		解説文
		SSGPCM.DTA		SSGPCM用PCMデータ
		SSGPCM.TBL		SSGPCM用テーブルファイル
		PCM.EXE			個別PCMファイルの圧縮版
		O2QB.COM		*.OのファイルをQuickBasicのBLOAD
					文で読み込ますための変換フィルタ
		SAMPLE.BAS		QuickBasic V4.5で演奏するための
					サンプル
		SAMPLE.N88		n88basic/MS-DOS版で演奏するため
					のサンプル
		SAMPLE.C		Turbo Cで演奏させるためのサンプ
					ル：提供JUMBO氏


	※PCM.TBL, PCM.DTA はみゅあっぷ98に付属のものを使用せずに、個別
	　PCMファイルをMAKEPCM.COMで結合したものをご使用下さい（個別PCM
	　データはPCM.EXEを実行して解凍して下さい）。


●特長

	(1) みゅあっぷ98N怨魔ﾌ統合環境で作成した音楽データをそのまま活用できる。
	(2) スピークボード+YM3438対応のFM,SSG,RHYTHM,PCM合計22和音。
	(3) SSGPCMによりYM2203のみでもFM*3+PCM*3を実現可能。
	(4) オールアセンブラにより演奏のためのCPU速度低下は最小(3～10%)。
	　　※SSGPCMを使用しない場合のみ。
	(5) 少ない使用メモリで実行可能(最小12KB)。
	(6) ユーザ開発プログラム(C,PASCAL,ASM,BASICなど)から直接アクセス可能。
	(7) ゲームなどに向いた効果音を簡単に発生。
	(8) カラオケ用に歌詞の取りだしも可能。


●起動の際のオプションパラメータ（-は/でも可）

	-Bxx	　SSGPCMバッファの容量を指定。xx=00～FFで、xx00hバイト
		確保されます。初期値はxx=80で32KB確保。

	-Fx	　フェードアウト速度の指定。x=0-9,A-Zまで。0が最も遅い。
		デフォルトは-F4。

	-I	　演奏ルーチン中で外部からの割り込みを禁止する。

	-Lxx	　ファンクションベクタ番号を指定する。デフォルトは-L60。

	-Oxx	　メインメモリ上に演奏バッファ領域を確保します(xx00h)。
		デフォルトでは確保しません。このオプションを指定するこ
		とでファンクションの10が使用可能になります。ファンクシ
		ョン10で読み込み可能な最大演奏ファイル容量はxx00hバイト
		になります。

	-P	　常駐時にPCM.DTAも読み込む([ESC]キー押下で中止できる)。
		常駐中に指定すると、演奏しながら読み込みます。

	-Q	　SSGPCM.DTA/TBLも読み込む。これで初めてSSGPCMが使用可
		能になる。

	-R	　常駐を解放する。

	-T	　TONES.DTA, PCM.DTA, PCM.TBL, SSGPCM.DTA, SSGPCM.TBL 
		が存在しなくてもエラーメッセージを表示しない。

	-Vxx	　タイマA割り込みベクタ番号を指定する。無指定では自動指
		定となるので普通指定はしません。xx=0B,10-17まで。0BがI
		NT0、10がセントロプリンタ、11がINT3、12がINT41、13がIN
		T42、14がINT5、15がINT6、16が8087、17はGNDとなっている。

	-Yx･･x	　YM2203/2608のポート番号を指定する。x･･xは4桁の16進数
		をYM2203アドレス,データ,YM2608アドレス,データ、と指定す
		る。デフォルトはYM2608,3438の自動検索。これも普通指定し
		ません。

	-Z	　H98用ウェイト（out 5fh,al）を挿入する。

	-6	　SSGPCMを16KHzモードで使用する。

	-?	　パラメータのヘルプを表示する。

	（例）		nax /o60/p/fe


●常駐時のオプションパラメータ（複数指定は不可）

	-P	　PCM.DTAを読み込む(PCM.TBLはそのまま、演奏中でも可能)。

	-R	　ＮＡＸを常駐から切り離す。

	-Xfile	　SSGPCM.DTA/TBLを指定ファイル名(拡張子は固定)のものを
		読み込む。演奏中でも可能。fileにはフルパス名を用いる。
		（例）nax -xpcm\kimi

	-?	　パラメータヘルプ(これ)を表示する。


●環境変数

	　環境変数DTAのパスにTONE.DTAが存在する必要があります。またPCM
	のパスにPCM.TBLが(-P指定時はPCM.DTAも)存在する必要があります。
	　さらに、-Q指定時はPCMのパスにSSGPCM.DTA/TBLも存在する必要があ
	ります。

	（例）		set dta=\naxsys
			set pcm=\naxdata


●常駐の際の注意

	　「みゅあっぷ98N怨磨vが常駐されている時に「ＮＡＸ」を常駐させた
	り、またその逆の行為をすることは出来ません。但し、みゅあっぷ98
	やＮＡＸと共存常駐はしてしまいます。


●ファンクションの実行

	　ユーザプログラムより演奏の制御が可能です。プログラム例を実行
	例として示しておきます。ファンクションの実行法は、

　　ファンクション番号　機能　　　　　　　　　　　レジスタ

	AH = 0	　ステータスの獲得	(出力) AL = 0 : サウンドボードなし
					　　　 AL = 1 : 標準のサウンドボード
					　　　 AL = 2 : スピークボード
					       AL = 3 : サウンドオーケストラ

	AH = 1	　演奏開始　　　　　	(入力) DX = 演奏データのセグメント
						※-Oオプション指定時は不要
	AH = 2	　演奏停止
	AH = 3	　フェードアウト
	AH = 4	　演奏再開
	AH = 5	　バンク切り換え	(入力) AL = 0 : 演奏バッファ裏バンク
					　　　 AL = 1 : バンク切り換えしない
							　(デフォルト)
						※-Oオプション指定時は無意味
	AH = 6	　YM2608レジスタ出力	(入力) DL = アドレス
					　　　 DH = データ
	AH = 7	　拡張部レジスタ出力	(入力) DL = アドレス
					　　　 DH = データ
	AH = 8	　@STOPされたチャネル	(入力) DL = 先頭からの@STOPの個数
		　を指定した位置から	　　　 DH = チャネル番号(1～15)
		　再開
	AH = 9	　フェードアウトの監視	(出力) AL = 0 : フェードアウト終了か
							AH=3を指定してない
					　　　 AL = 1 : フェードアウト中
	AH = 10	　演奏ファイルの読み込	(入力) DS:DX = パス名の番地
		　みと演奏開始		(出力) AL = 0 : 読み込み成功
					　　　 AL = 1 : 演奏バッファ未定義
					　　　 AL = 2 : 読み込み失敗
					　　　 AL = 3 : 演奏バッファ容量不足

	AH = 11   演奏バッファのオフセ　(入力) AL = チャネル番号(1～15)
		　ット獲得		(出力) AX = そのチャネルの先頭の
						　　オフセット
					　　　 DX = 現在演奏しているオフ
						　　セット

	AH = 12   @init,*,**コマンド実	(出力) AL = 0 : 実行されてない
		　行チェック		　　　 AL = 1 : 実行された
							(1ループ終了チェック)

	AH = 13   歌詞関係の情報	(出力) ES:DX = 歌詞データの格納番地
					       AL = 色変わり桁位置(0～)


	としてINT 60hを実行して下さい。なおこのベクタ番号は-Lオプション
	で変更可能です。
	　また、サウンドボードが装着されていない場合は全てのファンクシ
	ョンが無効になります。


		○演奏例（nax -o40 として常駐した場合）
			entory	DS:DX = パス名の番地

			mov	ah,0ah
			int	60h


		○実行例（裏G-VRAMを演奏バッファとして使用）
			entory	DS:DX = パス名の番地

			mov	ax,3560h
			int	21h		; 割り込みベクタの読みだし
			cmp	word ptr es:[106h],5678
			jne	not_resident

			mov	al,1
			out	0a6h,al		; 裏バンクに切り換える
			mov	ax,3d00h
			int	21h		; ファイルオープン
			jb	not_resident
			mov	bx,ax
			push	ds
			mov	ax,0a800h
			mov	ds,ax
			xor	dx,dx
			mov	cx,0ffffh
			mov	ah,3fh
			int	21h		; ファイル読み込み
			pop	ds
			mov	ah,3eh
			int	21h		; ファイルクローズ
			mov	al,0
			out	0a6h,al		; 表バンクに戻す

			mov	ax,500h
			int	60h		; バンク切り換えを指定
			mov	ah,1
			mov	dx,0a800h
			int	60h		; 演奏開始
	not_resident:


		○使用例(ファンクション8を用いた効果音の発生)

		<< MML >>

		1[ @13v13o5l8
				@label0
				( c>c< )4 ( e>e< )4
				@jump0  ]		; BGM用
		2[ @12v15o5l16
				@stop c<bagfedc	r	; 効果音その1
				@stop cdefgab>c	r	; 効果音その2
				@stop c2 r ]		; 効果音その3

		　注意　(1) 効果音の最後には必ず休符をつけて下さい。
			(2) メインで演奏しているチャネルには"*"コマンド
			　　を指定しないで下さい。
			(3) メインの演奏が止まると効果音は鳴りません。


		<< プログラム >>

			mov	dx,offset path
			mov	ah,0ah
			int	60h		; 演奏(BGM)開始
			　　･
			　　･
			　　･
			mov	ah,8
			mov	dx,0202h	; 効果音2の発生
			int	60h
			　　･
			　　･
			　　･
			mov	ah,8
			mov	dx,0201h	; 効果音1の発生
			int	60h

	※注意点
		　ＮＡＸで演奏中に、直接FM音源のポートを操作すると音が
		おかしくなります。もしも直接操作する必要のある場合は割
		り込み禁止にしてからアクセスし、終了後は割り込みを許可
		して下さい。またポート出力後はある程度ウェイトが必要で
		す。ジョイスティックの状態検出の場合によく引っかかりま
		す。


●その他

	　「ＮＡＸ」はフリーウェアです。また、改造したり、市販ソフトの
	演奏ルーチンとして使用しても構いません。但し、本ソフトウェアに
	バグが存在したとしてもその責任は負いません。
	　ソフトへの組み込みの際、当方まで作品をお送り下されば少しはア
	ドバイスできるかも知れませんが、別に連絡を強制したりはしません。
	　以前制約をつけていたドキュメントの同時添付ですが、今後は行な
	わなくて結構です。また、「ＮＡＸ」単体での販売、及び「みゅあっ
	ぷ98N怨磨vを添付しての販売は禁止します。
	　営利目的のご使用については、ご連絡下されば無償で承諾致します
	（別に連絡しなくても問題はありませんが）。
	また、機能追加を要求される場合にはご連絡の上相当額のご寄付をお
	願いします（優先的な処理ができませんのでご理解下さい）。


●「みゅあっぷ98N怨磨v入手方法

	　ソフトベンダー武尊でのみ販売しております。マニュアル（みゅあ
	っぷ98と共通）付きで3000円です。研究用ソースファイルは5000円で
	す（マニュアルはなし）。
	　SSGPCMが搭載されていない「みゅあっぷ98」は2500円で同じく販売
	しております。


◎原著作者・連絡先

	　ぱっくんソフト	〒569　大阪府高槻市淀の原町63-4

